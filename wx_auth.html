<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="target-densitydpi=device-dpi, width=640px, user-scalable=no">
  <meta name="format-detection" content="telephone=no">
  <title>微信授权</title>
</head>
<body>
<script>
  /**
  * 获取URL查询参数
  * @param {String} param URL parameter name
  */
 function getQueryVariable (param) {
  var query = window.location.search.substring(1)
  var vars = query.split('&')
  for (var i = 0; i < vars.length; i++) {
    var pair = vars[i].split('=')
    if (pair[0] === param) { return pair[1] }
  }
  return false
}

function wxUserInfo(code) {
  var xhr = new XMLHttpRequest()
  xhr.open('GET', '/api/wechat/getUserInfo?code='+code)
  xhr.send()
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
      var data = JSON.parse(xhr.responseText)
      if(data.code == 1) {
        window.location.href = '/ask1.html'
      }
    }
  }
}

var code = getQueryVariable('code')
wxUserInfo(code)


</script>
</body>
</html>
